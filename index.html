<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Mapbox Storytelling</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="style.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/mapbox/assembly/publisher-staging/src/svgs/mapbox.svg">
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="https://unpkg.com/simplebar@6.0.0/dist/simplebar.min.css" />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.js'></script>
    <script src="https://unpkg.com/intersection-observer@0.12.0/intersection-observer.js"></script>
    <script src="https://unpkg.com/scrollama"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js" charset="utf-8"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <style>
        a, a:hover, a:visited {
            color: #0071bc;
        }
        #map {
            top:0;
            height: 100vh;
            width:inherit;
            position: sticky;
        }
        #mapInset {
            bottom:50px;
            right:30px;
            height: 180px;
            width:250px;
            max-width:100%;
            position: fixed;
            z-index: 1;
            opacity: 1;
            transition: opacity 0.5s ease-in-out;
            pointer-events: none;
        }
        #mapInset .mapboxgl-ctrl-bottom-left{
            display: none;
        }
        @media (max-width: 500px) {
            #mapInset {
                display: none;
            }
        }
        #header {
            margin: auto;
            width: 100%;
            position: relative;
            z-index: 5;
        }
        #header h1, #header h2, #header p {
            margin: 0;
            padding: 2vh 2vw;
            text-align: center;
        }
        #footer {
            width: 100%;
            min-height: 5vh;
            padding-top: 2vh;
            padding-bottom: 2vh;
            text-align: center;
            line-height: 25px;
            font-size: 13px;
            position: relative;
            z-index: 5;
        }
        #features {
            padding-top: 10vh;
            padding-bottom: 10vh;
        }
        .hidden {
            visibility: hidden;
        }
        .centered {
            width: 50vw;
            margin: 0 auto;
        }
        .lefty {
            width: 33vw;
            margin-left: 5vw;
        }
        .righty {
            width: 33vw;
            margin-left: 62vw;
        }
        .fully {
            width: 100%;
            margin: auto;
        }
        .light {
            color: #444;
            background-color: #fafafa;
        }
        .dark {
            color: #fafafa;
            background-color: #444;
        }
        .step {
            padding-bottom: 50vh;
            /* margin-bottom: 10vh; */
            opacity: 0.25;
        }
        .step.active {
            opacity: 0.9;
        }

        .step div {
            padding:  25px 50px;
            line-height: 25px;
            font-size: 18px;
        }

        .step img {
            width: 100%;
        }

        @media (max-width: 750px) {
            .centered, .lefty, .righty, .fully {
                width: 90vw;
                margin: 0 auto;
            }
        }

        /* Fix issue on mobile browser where scroll breaks  */
        .mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,
        .mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas {
            touch-action: unset;
        }

        </style>
</head>
<main>
<body>
    <header class="container-fluid" id="title">
        <img src="media\story_title_2.png" class="title_layer">
        <img src="media\story_title_3.png" class="title_layer">
        <img src="media\story_title_4.png" class="title_layer">
    </header>

<div class="container" style="padding: 2.5rem 0 2.5rem 0">
    <div class="row">
        <div class="col-lg-6 offset-lg-3">
            <p style="font-size: 16px; text-align: center;">By Elijah Nicholson-Messmer</p>
            <p>When Alexandra Stephanou and her partner started looking for a new apartment back in February, “rent bidding” was an unfamiliar concept to them. By the end of their search, it was a $1,200 reality.</p>
            <p>After living in the same North End apartment since moving to Boston in May 2020, Stephanou enlisted the help of a local real estate agent to ease the process of looking for a new apartment. The agent's assistance quickly proved to be a stressor itself.</p>
            <p>“She was very aggressive with [saying], ‘Well, if you like it, you have to apply now,’” Stephanou said. “And mind you, this is early March and we're trying to rent a Sept. 1 unit. She created an environment of a lot of pressure, like: ‘There is going to be rent bidding. Are you prepared for that?’”</p>
            <p>Despite the pressure from her agent, Stephanou was not rushing to apply for any of the poorly maintained, often dirty apartments she toured, let alone bid on them. Then, one Friday night, she saw an apartment — <i>the apartment</i> — pop up on Zillow. She contacted the listing agent immediately.</p>
            <p>The agent, Scott Haines, responded, telling her there was a tour scheduled the next morning. There is a lot of interest, Haines said, so make sure to arrive on time. Saturday morning, Stephanou and her partner arrived right at the scheduled time only to see “12 people with different brokers walking through the apartment.”</p>
            <p>As soon as Stephanou stepped into the apartment with Haines, she knew she wanted to apply.</p>
            <p>“He gave us the information and told us to run home and apply,” she said. “So that's what we did. We shuffled home really quickly, got all the paperwork done in a frenzy, and then in the span of just a few hours, he was able to say that our application was approved.”</p>
            <p>Then came the bid.</p>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6 offset-lg-3">
            <p class="message-container sender">He just called. He received an application along with ours and they’re offering $3,500, $100 more than the asking price. He prefers to go with you, but wanted to see if you’ll take it for $3,500.</p>
            <p class="message-container receiver">Thanks for the transparency. If we do $3,500 would that definitely include the parking spot? We’re happy to match that offer.</p>
            <p class="message-container sender">“Parking is $100 [extra] per month. I would do two tandem spots for $150 a month. Pet fee is $50 per month”</p>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-6 offset-lg-3">
            <p style="margin-top: 1rem;">Stephanou called Haines: “Are you bullsh---ing us? Did somebody really put [a bid] on an application?”</p>
            <p>“It's pretty common,” Haines told her.</p>
            <p>Reluctantly, Stephanou and her partner agreed to match the other applicant’s offer. The one-bedroom, already listed for $3,400, was about to get even more expensive.</p>
            <p>All in, they paid $250 over the asking price, with a $100 bid, a $100 parking spot, and a $50 pet fee. Over their 12-month lease, that equates to $3,000 in unexpected expenses.</p>
            <p>“I sympathize with renters and give them a lot of credit for putting up with the rental market, but what can be done?” Haines said in an email. “It's simply capitalism. Money talks.”</p>
        </div>
    </div>
</div>

<div style="position: relative;">
    <div id="map">
        <div id="legend">
            <div class="legend-title"></div>
        </div>
    </div>
    <div id="mapInset"></div>
    <div id="story"></div>
</div>

<div class="container" style="padding-top: 2.5rem;">
    <div class="row" style="text-align: left;">
        <div class="col-lg-6 offset-lg-3">
            <button type="button" id="scrollButton" class="custom-button">Explore the map</button>
            <h3>A costly recovery</h3>
            <p>Real estate agents point to a variety of factors behind the emerging issue, including rising interest rates that are forcing would-be home buyers to remain in the rental market, the return-to-office push by employers, and a sub-1% vacancy rate across greater Boston.</p>
            <p>devin michelle bunten, an assistant professor in the Department of Urban Studies and Planning at MIT, said housing shortages, whether in sales or rentals, are at the root of hyper-competitive markets like Boston’s</p>
            <p>Boston’s vacancy rate hit a multi-year high of nearly 8% in Sept. 2020, but the number of available rentals has rapidly declined across the city, driving the vacancy rate to below pre-pandemic numbers.</p>
            <p>The city’s tight market leaves many renters lining up, often literally, for a limited number of units.</p>
            <p>One way that higher-income individuals, and low-income renters with roommates, "try to jump the line is by offering above the asking price," bunten said.</p>
            <p>The emerging phenomenon is a boon for landlords, some of whom may be using rent bidding to make up for revenue they lost during the state's six-month eviction moratorium back in 2020, said Sarah Doucette, a real estate agent at Rise Realty.</p>
            <p>Rather than simply increasing rent prices in unit listings, landlords may use rent bidding as a tool to learn just how much they can charge for an apartment in the current market, bunten said.</p>
        </div>
    </div>
</div>
<div class="container">
    <div class="row" style="text-align: left;">
        <div class="col-lg-6 offset-lg-3">
            <h3>Standing out at any cost</h3>
            <p>Rent bidding is not the only tactic Boston renters have used to try to get an edge in a competitive market. One Cambridge renter said that while she did not bid on the rent price itself, she did offer her agent $500 in cash on top of the standard fee to secure an apartment.</p>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-10 offset-lg-1">
            <div id='barPlot' style="margin-bottom: 1rem;"></div>
        </div>
        <div class="col-lg-6 offset-lg-3">
            <p>A Somerville resident said that, on top of offering an extra $150 a month on the listed rent price, she also created a “rental resume”' for her and her roommates, detailing references, hobbies, and job experience to strengthen their application, at her broker’s suggestion.</p>
            <p>Even high-earners like Stephanou and her partner have tried signing longer leases to escape a bidding war.</p>
            <p>“The whole experience just made us feel really fortunate that we have that type of income to pay for a place like this — as well as really discouraged about the housing market,” Stephanou said. “I don't know how people afford to live here who don't have high-paying jobs. I don't understand how families or low-income families do it.”</p>
        </div>
    </div>
</div>
<div class="container">
    <div class="row" style="text-align: left;">
        <div class="col-lg-6 offset-lg-3">
            <h3>An academic problem</h3>
        </div>
            <section id="scrolly">
                <div class="sticky-thing">
                    <div id="scatterPlot" style="width: 100%; height: 100%;"></div>
                </div>
                <article class="scrolly-overlay">
                <div class="part" id="part1">
                </div>
                <div class="part" id="part2">
                    <p>In Allston, a quarter of all apartments were bid up from their initial list price. Data show that the neighborhood’s popularity among <span style="background-color: #69907f;">university students</span> may be partially to blame for the high rate of rent bidding.</p>
                </div>
                <div class="part" id="part3">
                    <p>There is a consistent pattern across Boston ZIP codes: Areas with more students also tend to have higher rates of rent bidding.</p>
                </div>
                <div class="part" id="part4">
                    <p><span style="background-color: #16457f;">Undergraduate students</span> are a big contributor to that pattern. Although most of them live on campus or in university-provided housing, there were still 18,500 undergraduate students who competed for rental market housing in 2022.</p>
                </div>
                <div class="part" id="part5">
                    <p>That pattern is particularly strong when it comes to <span style="background-color: #ff6224;">graduate students</span>, who are responsible for 37% of the rent bidding variance in a given ZIP Code. Generally speaking, a ZIP code’s rate of rent bidding increases by 1% for every 275 additional graduate students living there.</p>
                </div>
                <div class="part" id="part6">
                    <p>While undergraduate enrollment has remained relatively flat over the last 10 years, the number of graduate students across Boston has risen 20% just since 2020, according to the <a href="https://www.boston.gov/sites/default/files/file/2023/06/Student%20Housing%20Report%2C%202022.pdf" target="_blank" style="color: inherit;"><span style="transition: color 0.3s;">City of Boston</span></a>.</p>
                </div>
                <div class="part" id="part7">
                    <p>Only 10% of graduate students live on campus or in university-provided housing, making rising rates of enrollment a concern in a tight housing market.</p>
                </div>
                <div class="part" id="part8">
                    <p>Nearly three-quarters of Boston’s graduate students are concentrated in just five ZIP codes. On average, 17% of rentals went for above the asking price in these neighborhoods — 4% higher than the average rate for the rest of Boston.</p>
                </div>
                <div class="part" id="part9">
                    <p>Doucette, a Somerville-based real estate agent, said all of her clients who participated in bidding wars this year were students, usually at the graduate level. “I don't really see bidding wars amongst working people. It's mostly this September 1st student rush,” she said. “It's just very competitive. And it seems like they're willing to pay whatever it takes just to get into the apartment.”</p>
                </div>
                </article>
              </section>
        <div class="col-lg-6 offset-lg-3">
            <p>For Moritz Proell, a third-year undergraduate student at Northeastern University, rent bidding came as an unwelcome surprise when he and his three roommates started looking for an apartment earlier this year.</p>
            <p>“It’s not really common that you would bid for a rental apartment. So, we were very surprised,” Proell said.</p>
            <p>Early in their search, Proell and his roommates were encouraged by an agent to bid above the asking price on an apartment they were applying for in the Fenway–Kenmore area. After offering $200 on top of the $5,200 list price of a 4-bedroom unit, another applicant outbid them. The agent asked Proell and his teammates if they wanted to increase the bid again, but they decided it was too much for them.</p>
            <p>The group soon found another 4-bedroom unit in Mission Hill, but the apartment was getting a lot of interest from different students. Determined to secure the apartment, Proell and his roommates offered $400 over the $4,500 asking price. It worked.</p>
            <p>“There was no second round of bidding,” Proell said. “We substantially outbid, I think, most of the competition.”</p>
            <p>Proell and most of his roommates get financial support from their parents, he said. “Otherwise, we would be unable to afford moving off campus,” he said.</p>
            <p>Ranjita Singh-Ortiz, a partner and broker at Cambridge Premier Realty, said some undergraduates like Proell may get financial help from their parents, but many graduate students who participate in rent bidding are taking on extra loan debt to secure an apartment.</p>
            <p>Students and young professionals are often more willing to bid on apartments than other renters, but the practice is often prompted by landlords, Singh-Ortiz said.</p>
            <p>Multiple clients who Singh-Ortiz helped were asked by landlords after their application was approved if they would be willing to increase the price even after signing the lease.</p>
            <p>“That happens a lot,” she said. “It kind of boggles my mind because, at that stage in a deal, when the clients have signed the lease and given all the funds, they were approved by the landlord and the property was off the market, it’s considered a done deal — but it wasn't a done deal this year on multiple occasions.”</p>
            <p>The squeeze from rent bidding is maxing out some renters financially, Singh-Ortiz said. It’s also forcing others out of neighborhoods entirely.</p>
         </div>
    </div>
</div>
<div class="container">
    <div class="row" style="text-align: left;">
        <div class="col-lg-6 offset-lg-3">
            <h3>The rent eats first</h3>
            <p>Neighborhoods with large Black and Latino populations like Roxbury and Dorchester have some of the most severe rent bidding in the greater Boston area. Bidding wars don&rsquo;t pop up as frequently in these neighborhoods compared to the rest of the city, but when they do renters end up paying 7% to 8% above the list price on average — amounting to thousands of dollars a year in additional rent costs.</p>
            <p>For Black and Latino residents, who are already disproportionally rent-burdened, keeping up with such bidding wars may push them to even more severe degrees of rent burden.</p>         
        </div>
        <div id='barPro'></div>
        <div class="col-lg-10 offset-lg-1" style="text-align: center;">
            <svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 579 17.43" width="80%" height="30">
                <defs>
                  <style>
                    .cls-1 {
                      fill: none;
                      stroke: url(#linear-gradient);
                      stroke-miterlimit: 10;
                      stroke-width: 2.5px;
                    }
              
                    .cls-2 {
                      fill: url(#linear-gradient-2);
                    }
              
                    .cls-2, .cls-3 {
                      stroke-width: 0px;
                    }
              
                    .cls-3 {
                      fill: url(#linear-gradient-3);
                    }
                  </style>
                  <linearGradient id="linear-gradient" x1="0" y1="8.72" x2="579" y2="8.72" gradientUnits="userSpaceOnUse">
                    <stop offset="0" stop-color="#16457f"/>
                    <stop offset=".25" stop-color="#007084"/>
                    <stop offset=".5" stop-color="#69907f"/>
                    <stop offset=".71" stop-color="#c9984e"/>
                    <stop offset="1" stop-color="#ff6224"/>
                  </linearGradient>
                  <linearGradient id="linear-gradient-2" y1="8.72" y2="8.72" xlink:href="#linear-gradient"/>
                  <linearGradient id="linear-gradient-3" y1="8.72" y2="8.72" xlink:href="#linear-gradient"/>
                </defs>
                <line class="cls-1" x1="26.58" y1="8.72" x2="552.42" y2="8.72"/>
                <polygon class="cls-2" points="32.52 17.43 0 8.72 32.52 0 32.52 17.43"/>
                <polygon class="cls-3" points="546.48 17.43 579 8.72 546.48 0 546.48 17.43"/>
                <text x="35" y="7" font-size="10" fill="#16457f">Less income spent on rent</text>
                <text x="540" y="7" font-size="10" fill="#ff6224" text-anchor="end">More income spent on rent</text>
              </svg>
        </div>
        <div class="col-lg-6 offset-lg-3">
            <p style="margin-top: 1rem;">TK: Working to interview City Life/Vida Urbana source (Scheduled for this Thursday, the 9th)</p>       
        </div>
    </div>
</div>
<div class="container">
    <div class="row" style="text-align: left;">
        <div class="col-lg-6 offset-lg-3">
            <h3>The regulatory landscape</h3>
            <p>Real estate agents are not prohibited by any regulations from participating in rent bidding, according to the Board of Registration of Real Estate Brokers and Salespersons.</p>
            <p>Some brokerage agencies have internal policies to prohibit bidding wars, but, for such policies to work, landlords have to offer an "exclusive listing", in which they choose to list with only one agency. But, it’s unknown how common such exclusive listings are.</p>
            <p>Even for Scott Haines — whose brokerage’s internal policy does not allow for rent bidding — the majority of rentals he works with are “open,” meaning that multiple brokerages have access to advertise and rent out the apartment.</p>
            <p>“When my clients are interested in an apartment that's exclusive to another brokerage, especially if there's an open house, I tell them that there are apartments out there that rent for a price higher than asking,” Hanes said in an email. “I'm the source of the information and it's up to them to make a decision.”</p>
            <p>Under the current regulatory landscape, whether or not a bidding war happens is ultimately up to the landlord, according to Doucette, a local real estate agent.</p>
            <p>The lack of regulation is unsurprising given the phenomenon’s nascent state in Boston, but, brokers like Doucette would like to see legislation passed that bans the practice.</p>
            <p>“The rents are one price advertised and that's really what it should be,” Doucette said. “You know, you have somebody with a certain budget and then you have to really go into it telling them it's going to be $100 to $200 over.”</p>
            <p>Exactly what that regulation would look like for Boston is unclear, but countries like Australia offer some potential approaches.</p>
            <p>The Australian state of Queensland led the country in addressing rent bidding, <a href="https://www.rta.qld.gov.au/before-renting/choosing-a-rental-property/rent-bidding" target="_blank" style="color: inherit;"><span style="transition: color 0.3s;">passing legislation</span></a> in 2008 that barred landlords and agents from soliciting bids from applicants. Other states have followed suit over the past few years, with Victoria, South Australia, and New South Wales all passing their own bans on the practice as the country’s rental market has grown increasingly competitive.</p>
            <p>The exact legislation differs from state to state, but most bans in the country only prohibit the solicitation of bids, not the acceptance of them. In practice, that means rent bidding is still legal when applicants make unprompted offers above the asking price.</p>
            <p>Chris Martin, a senior research fellow at City Futures Research Centre in New South Wales, said that regulating the solicitation of bids is “absolutely a good move,” but where Governments go from there is still a topic of debate.</p>
        </div>
    </div>
</div>
<div class="container">
    <div class="row" style="text-align: left;">
        <div class="col-lg-6 offset-lg-3">
            <h3>The prohibition problem</h3>
            <p>At the heart of that debate is the same tension that defines all prohibition arguments — outlaw a practice in its entirety and risk creating an illicit market or legalize and regulate the practice.</p>
            <p>Last month, Victoria’s state government opted for the former of the two approaches, announcing its plan to fully ban the solicitation and acceptance of rental bids. The move was welcomed by housing advocates, but experts like Martin have “real doubts about the practicality” of the state’s approach.</p>
            <p>“I don't think regulators have a lot of insight into what happens between the application process and the signing of a lease,” Martin said. “That sort of regulatory surveillance is something they don't do, and it would be quite a task for them to do it, I think.”</p>
            <p>In neighboring New South Wales, <a href="https://www.theguardian.com/australia-news/2023/mar/03/no-real-estate-agents-fined-for-breaking-nsw-rent-bidding-rules" target="_blank" style="color: inherit;"><span style="transition: color 0.3s;">Guardian Australia</span></a> found that since the state passed its ban on the solicitation of rent bids last year, the government had not issued a single fine to agents or landlords, despite handing out hundreds of warnings. Whether Victoria can take on such a regulatory undertaking remains to be seen.</p>
            <p>Real estate groups have warned that a total ban could also lead to jacked-up list prices, where instead of receiving bids on a modest list price, landlords could start the unit at a high price and slowly lower the price until it is rented. But, Victoria’s Premier pushed back against such “<a href="https://www.theguardian.com/australia-news/2023/sep/21/victorias-expanded-rent-bidding-ban-sparks-concerns-over-enforcement-and-effectiveness" target="_blank" style="color: inherit;"><span style="transition: color 0.3s;">doomsday predictions</span></a>.”</p>
            <p>In New South Wales, the bidding ban has led to the rise of “secret rent bidding,” where some applicants have continued to make offers above the asking price on apartments, without any solicitation from the agent or landlord. The problem is exacerbated by the fact that agents are not allowed to disclose to other applicants that a bid has been made on the unit, leading some applicants to make costly offers for fear that someone else will outbid them.</p>
            <p>To address these secret bidding wars, the state government announced this past May a proposal to <a href="https://www.theguardian.com/australia-news/2023/may/09/nsw-moves-to-end-secret-rental-bidding-and-bring-in-portable-bonds-schem" target="_blank" style="color: inherit;"><span style="transition: color 0.3s;">formalize the rent bidding process</span></a>. Under the proposal, agents would have to keep a record of any bids made on a unit and report any bids to other applicants, allowing them time to make a counteroffer if they decided to. The news was met with criticism from housing advocacy groups, who said that the proposal would <a href="https://www.parliament.nsw.gov.au/ladocs/inquiries/2961/Report%20-%20Residential%20Tenancies%20Amendment%20(Rental%20Fairness)%20Bill%202023.PDF" target="_blank" style="color: inherit;"><span style="transition: color 0.3s;">ultimately encourage</span></a> rent bidding.</p>
            <p>Martin, who was in a minority of housing experts who supported the proposal, said that the proposal would — along with eliminating secret rent bidding — potentially discourage parties from participating in it in the first place.</p>
            <p>“If an applicant thought that the higher bid they were making wasn't going to be secret and that it could initiate a rent bidding situation, they'd probably be less inclined to do it,” Martin said. “So, even as it formalizes rent bidding, it will probably be mildly discouraging.”</p>
            <p>At the risk of the government’s broader housing legislation not passing, the proposal was ultimately <a href="https://www.theguardian.com/australia-news/2023/jun/07/nsw-government-shelves-controversial-secret-rent-bidding-ban-after-warnings-of-price-increases" target="_blank" style="color: inherit;"><span style="transition: color 0.3s;">dropped</span></a> from the bill. Despite his own support for the proposal, Martin said its loss is not particularly significant in the broader picture of addressing the state’s rental market.</p>
            <p>Without more impactful reform alongside a rent bidding ban, such legislation is simply “Band-Aid law reform,” he said.</p>
        </div>
    </div>
</div>
        <div id="dashboard">  
            <div id="legend2">
                <div class="legend-title2"></div>
            </div>            
            <div id="searchInput">
                <h3 id="searchHeader">How bad is rent bidding near you?</h3>
                <input type="text" id="zipInput" placeholder="Search for a zip code">
                <div class="toggleButtons">
                    <button class="toggle-button" data-value="layer1">Frequency</button>
                    <button class="toggle-button" data-value="layer2">Severity</button>
                </div>
                <ul id="zipList" class="autocomplete"></ul>
                <div data-simplebar id="zipInfo">
                        <h2 id="zipCode"></h2>
                        <span style="display: block; background-color: #EDA229; width: 100%; height: 20px;"></span>
                    <div id="info1">
                        <h6>Bidding rate</h6>
                        <h2 id="stat1"></h2>
                    </div>
                    <div id="info2">
                        <h6>Percent price increase</h6>
                        <div class="zipStats" id="zipStats1">
                            <h2 id="stat2"></h2>
                            <div>
                                <p class="miniStats" id="stat3"></p>
                                <p class="miniStats" id="stat4"></p>
                            </div>
                        </div>
                    </div>
                    <div id="info3">
                        <h6>Average price increase</h6>
                        <div class="zipStats" id="zipStats2">
                            <h2 id="stat5"></h2>
                            <div>
                                <p class="miniStats" id="stat6"></p>
                                <p class="miniStats" id="stat7"></p>
                            </div>
                        </div>
                    </div>
                    <div class="button-container">
                        <button id="showMoreButton" class="custom-button">
                            <span class="button-text">View more data</span>
                            <span class="arrow-container">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-down arrow-icon arrow-down" viewBox="0 0 16 16">
                                    <path d="M8.63 10.97l3.647-2.972a.25.25 0 0 0 0-.39l-1.395-1.14a.25.25 0 0 0-.364.03L8 8.293 5.47 6.406a.25.25 0 0 0-.364-.03l-1.395 1.14a.25.25 0 0 0 0 .39l3.647 2.972a.25.25 0 0 0 .372 0z"/>
                                </svg>
                            </span>
                        </button>                                                         
                    </div>
                    <div id="additionalStats" style="display: none; padding-bottom: 1rem;">
                        <div class="extraHeads">
                            <h6>City difference</h6>
                        </div>
                        <div>
                            <h6 class="cityDifLabels">Bidding rate</h6>
                            <h6 class="cityDifNums" id="city1"><span id="stat8"></span></h6>
                        </div>
                        <div>
                            <h6 class="cityDifLabels">Percent price increase</h6>
                            <h6 class="cityDifNums" id="city2"><span id="stat9"></span></h6>
                        </div>
                        <div>
                            <h6 class="cityDifLabels">Average price increase</h6>
                            <h6 class="cityDifNums" id="city3"><span id="stat10"></span></h6>
                        </div>
                        <div class="extraHeads">
                            <h6>Census demographics</h6>
                        </div>
                        <div class="censusStats">
                            <h6 class="censusLabel">Population:</h6>
                            <h6 class="censusNum" id="stat11"></h6>
                        </div>
                        <div class="censusStats" id="studentPop">
                            <h6 class="censusLabel">Student population:</h6>
                            <h6 class="censusNum" id="stat12"></h6>
                        </div>
                        <div class="censusStats">
                            <h6 class="censusLabel">Poverty rate:</h6>
                            <h6 class="censusNum" id="stat13"></h6>
                        </div>           
                        <div class="censusStats">
                            <h6 class="censusLabel">Median income:</h6>
                            <h6 class="censusNum" id="stat14"></h6>
                        </div>  
                        <div class="censusStats">
                            <h6 class="censusLabel">Black:</h6>
                            <h6 class="censusNum" id="stat15"></h6>
                        </div>    
                        <div class="censusStats">
                            <h6 class="censusLabel">Latino:</h6>
                            <h6 class="censusNum" id="stat16"></h6>
                        </div>  
                        <div class="censusStats">
                            <h6 class="censusLabel">White:</h6>
                            <h6 class="censusNum" id="stat17"></h6>
                        </div>  
                        <div class="censusStats">
                            <h6 class="censusLabel">Asian:</h6>
                            <h6 class="censusNum" id="stat18"></h6>
                        </div>  
                        <div class="censusStats">
                            <h6 class="censusLabel">Multiple races:</h6>
                            <h6 class="censusNum" id="stat19"></h6>
                        </div>  
                    </div>
                </div>              
            </div>
        </div>
<div class="container" style="padding-top: 3rem;">
    <div class="row" style="text-align: left;">
        <div class="col-lg-6 offset-lg-3">
            <h3>The new rules</h3>
            <p>As Boston's supply of housing trails behind demand, rent bidding will likely continue.</p>
            <p>Housing shortages turn the rental market into a game of musical chairs, bunten said. Historically, the people who were able to secure a seat, so to speak, were those who submitted their applications the quickest, assuming they met the landlord's qualifications.</p>
            <p>Rent bidding is changing that.</p>
            <p>Now, some renters are simply paying to get a seat — and taking on a higher rent burden in doing so. Others, may not get a seat at all.</p>
            <p>"In any case, there's a bunch of folks who are not gonna be able to sit down and who are not going to be able to find housing in Boston," bunten said.</p>
        </div>
    </div>
</div>
<footer class="container" style="padding-top: 5rem"></footer>

<script src="script.js"></script>
<script src="scrollama.js"></script>
<script src="./config.js"></script>
<script src="https://unpkg.com/simplebar@6.0.0/dist/simplebar.min.js"></script>

<script>
var initLoad = true;
var layerTypes = {
    'fill': ['fill-opacity'],
    'line': ['line-opacity'],
    'circle': ['circle-opacity', 'circle-stroke-opacity'],
    'symbol': ['icon-opacity', 'text-opacity'],
    'raster': ['raster-opacity'],
    'fill-extrusion': ['fill-extrusion-opacity'],
    'heatmap': ['heatmap-opacity']
}

var alignments = {
    'left': 'lefty',
    'center': 'centered',
    'right': 'righty',
    'full': 'fully'
}

function getLayerPaintType(layer) {
    var layerType = map.getLayer(layer).type;
    return layerTypes[layerType];
}

function setLayerOpacity(layer) {
    var paintProps = getLayerPaintType(layer.layer);
    paintProps.forEach(function(prop) {
        var options = {};
        if (layer.duration) {
            var transitionProp = prop + "-transition";
            options = { "duration": layer.duration };
            map.setPaintProperty(layer.layer, transitionProp, options);
        }
        map.setPaintProperty(layer.layer, prop, layer.opacity, options);
    });
}

var story = document.getElementById('story');
var features = document.createElement('div');
features.setAttribute('id', 'features');

var header = document.createElement('div');

if (config.title) {
    var titleText = document.createElement('h1');
    titleText.innerText = config.title;
    header.appendChild(titleText);
}

if (config.subtitle) {
    var subtitleText = document.createElement('h2');
    subtitleText.innerText = config.subtitle;
    header.appendChild(subtitleText);
}

if (config.byline) {
    var bylineText = document.createElement('p');
    bylineText.innerText = config.byline;
    header.appendChild(bylineText);
}

if (header.innerText.length > 0) {
    header.classList.add(config.theme);
    header.setAttribute('id', 'header');
    story.appendChild(header);
}

config.chapters.forEach((record, idx) => {
    var container = document.createElement('div');
    var chapter = document.createElement('div');

    if (record.title) {
        var title = document.createElement('h3');
        title.innerText = record.title;
        chapter.appendChild(title);
    }

    if (record.image) {
        var image = new Image();
        image.src = record.image;
        chapter.appendChild(image);
    }

    if (record.description) {
        var story = document.createElement('p');
        story.innerHTML = record.description;
        chapter.appendChild(story);
    }

    container.setAttribute('id', record.id);
    container.classList.add('step');
    if (idx === 0) {
        container.classList.add('active');
    }

    chapter.classList.add(config.theme);
    container.appendChild(chapter);
    container.classList.add(alignments[record.alignment] || 'centered');
    if (record.hidden) {
        container.classList.add('hidden');
    }
    features.appendChild(container);
});

story.appendChild(features);

var footer = document.createElement('div');

if (config.footer) {
    var footerText = document.createElement('p');
    footerText.innerHTML = config.footer;
    footer.appendChild(footerText);
}

if (footer.innerText.length > 0) {
    footer.classList.add(config.theme);
    footer.setAttribute('id', 'footer');
    story.appendChild(footer);
}

mapboxgl.accessToken = config.accessToken;

const transformRequest = (url) => {
    const hasQuery = url.indexOf("?") !== -1;
    const suffix = hasQuery ? "&pluginName=scrollytellingV2" : "?pluginName=scrollytellingV2";
    return {
        url: url + suffix
    }
}

var map = new mapboxgl.Map({
    container: 'map',
    style: config.style,
    center: config.chapters[0].location.center,
    zoom: config.chapters[0].location.zoom,
    bearing: config.chapters[0].location.bearing,
    pitch: config.chapters[0].location.pitch,
    interactive: false,
    transformRequest: transformRequest,
    projection: config.projection
});

// Create a inset map if enabled in config.js
if (config.inset) {
    var insetMap = new mapboxgl.Map({
    container: 'mapInset', // container id
    style: 'mapbox://styles/mapbox/dark-v10', //hosted style id
    center: config.chapters[0].location.center,
    // Hardcode above center value if you want insetMap to be static.
    zoom: 3, // starting zoom
    hash: false,
    interactive: false,
    attributionControl: false,
    //Future: Once official mapbox-gl-js has globe view enabled,
    //insetmap can be a globe with the following parameter.
    //projection: 'globe'
    });
}

if (config.showMarkers) {
    var marker = new mapboxgl.Marker({ color: config.markerColor });
    marker.setLngLat(config.chapters[0].location.center).addTo(map);
}

// instantiate the scrollama
var scroller1 = scrollama();


map.on("load", function() {
    if (config.use3dTerrain) {
        map.addSource('mapbox-dem', {
            'type': 'raster-dem',
            'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
            'tileSize': 512,
            'maxzoom': 14
        });
        // add the DEM source as a terrain layer with exaggerated height
        map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1.5 });

        // add a sky layer that will show when the map is highly pitched
        map.addLayer({
            'id': 'sky',
            'type': 'sky',
            'paint': {
                'sky-type': 'atmosphere',
                'sky-atmosphere-sun': [0.0, 0.0],
                'sky-atmosphere-sun-intensity': 15
            }
        });
    };

    // As the map moves, grab and update bounds in inset map.
    if (config.inset) {
    map.on('move', getInsetBounds);
    }
    // setup the instance, pass callback functions
    scroller1
    .setup({
        step: '.step',
        offset: 0.5,
        progress: true
    })
    .onStepEnter(async response => {
        var current_chapter = config.chapters.findIndex(chap => chap.id === response.element.id);
        var chapter = config.chapters[current_chapter];
        
        response.element.classList.add('active');
        map[chapter.mapAnimation || 'flyTo'](chapter.location);

        // Incase you do not want to have a dynamic inset map,
        // rather want to keep it a static view but still change the
        // bbox as main map move: comment out the below if section.
        if (config.inset) {
            if (chapter.location.zoom < 5) {
            insetMap.flyTo({center: chapter.location.center, zoom: 0});
            }
            else {
            insetMap.flyTo({center: chapter.location.center, zoom: 3});
            }
        }
        if (config.showMarkers) {
            marker.setLngLat(chapter.location.center);
        }
        if (chapter.onChapterEnter.length > 0) {
            chapter.onChapterEnter.forEach(setLayerOpacity);
        }
        if (chapter.callback) {
            window[chapter.callback]();
        }
        if (chapter.rotateAnimation) {
            map.once('moveend', () => {
                const rotateNumber = map.getBearing();
                map.rotateTo(rotateNumber + 180, {
                    duration: 30000, easing: function (t) {
                        return t;
                    }
                });
            });
        }
        if (config.auto) {
                var next_chapter = (current_chapter + 1) % config.chapters.length;
                map.once('moveend', () => {
                    document.querySelectorAll('[data-scrollama-index="' + next_chapter.toString() + '"]')[0].scrollIntoView();
                });
        }
    })
    .onStepExit(response => {
        var chapter = config.chapters.find(chap => chap.id === response.element.id);
        response.element.classList.remove('active');
        if (chapter.onChapterExit.length > 0) {
            chapter.onChapterExit.forEach(setLayerOpacity);
        }
    });


    if (config.auto) {
        document.querySelectorAll('[data-scrollama-index="0"]')[0].scrollIntoView();
    }
});

//Helper functions for insetmap
function getInsetBounds() {
            let bounds = map.getBounds();

            let boundsJson = {
                "type": "FeatureCollection",
                "features": [{
                    "type": "Feature",
                    "properties": {},
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [
                            [
                                [
                                    bounds._sw.lng,
                                    bounds._sw.lat
                                ],
                                [
                                    bounds._ne.lng,
                                    bounds._sw.lat
                                ],
                                [
                                    bounds._ne.lng,
                                    bounds._ne.lat
                                ],
                                [
                                    bounds._sw.lng,
                                    bounds._ne.lat
                                ],
                                [
                                    bounds._sw.lng,
                                    bounds._sw.lat
                                ]
                            ]
                        ]
                    }
                }]
            }

            if (initLoad) {
                addInsetLayer(boundsJson);
                initLoad = false;
            } else {
                updateInsetLayer(boundsJson);
            }

        }

function addInsetLayer(bounds) {
    insetMap.addSource('boundsSource', {
        'type': 'geojson',
        'data': bounds
    });

    insetMap.addLayer({
        'id': 'boundsLayer',
        'type': 'fill',
        'source': 'boundsSource', // reference the data source
        'layout': {},
        'paint': {
            'fill-color': '#fff', // blue color fill
            'fill-opacity': 0.2
        }
    });
    // // Add a black outline around the polygon.
    insetMap.addLayer({
        'id': 'outlineLayer',
        'type': 'line',
        'source': 'boundsSource',
        'layout': {},
        'paint': {
            'line-color': '#000',
            'line-width': 1
        }
    });
}

function updateInsetLayer(bounds) {
    insetMap.getSource('boundsSource').setData(bounds);
}



// setup resize event
window.addEventListener('resize', scroller1.resize);

</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    mapboxgl.accessToken = 'pk.eyJ1IjoiZWxpamFoLW1lc3NtZXIiLCJhIjoiY2xmYWNkMnFnMDRiZTNwcGJsM2J0ZjRpeCJ9.srDYVTRF4yqQ9QIz5b3EvA';
    const map2 = new mapboxgl.Map({
        container: 'dashboard',
        style: 'mapbox://styles/elijah-messmer/cln4vvc0x06wc01ns1l7m0b8m',
        center: [-71.13983, 42.33769],
        zoom: 11,
    });

    function updateLegend1_1() {
    const title = 'Percent of apartments bid up';
    const colors = ['#6ff6f6', '#05638f'];  // Define the start and end colors for the gradient

    d3.select('#legend2').transition().duration(1000).style('opacity', 1);

    const legend = document.querySelector('#legend2');

    const legendTitle = legend.querySelector('.legend-title2');
    legendTitle.textContent = title;

    const existingContainer = legend.querySelector('.gradient-marks-container');
    if (existingContainer) {
        // Update the marks only if the container exists
        const marksContainer = existingContainer.querySelector('.legend-marks');
        marksContainer.innerHTML = ''; // Clear existing marks
        const marks = ['0%', '13%', '26%'];
        marks.forEach((mark, index) => {
            const markElement = document.createElement('div');
            markElement.classList.add('legend-mark');
            markElement.textContent = mark;
            if (index === 0) {
                markElement.style.textAlign = 'left';
            } else if (index === marks.length - 1) {
                markElement.style.textAlign = 'right';
            }
            marksContainer.appendChild(markElement);
        });
    } else {
        // If container doesn't exist, create and append it
        const gradientMarksContainer = document.createElement('div');
        gradientMarksContainer.classList.add('gradient-marks-container');
        gradientMarksContainer.innerHTML = `
            <div class="legend-title2 added">${title}</div>
            <div class="legend-gradient" style="background-image: linear-gradient(to right, ${colors[0]}, ${colors[1]})"></div>
            <div class="legend-marks"></div>
        `;

        const marksContainer = gradientMarksContainer.querySelector('.legend-marks');
        const marks = ['0%', '13%', '26%'];
        marks.forEach((mark, index) => {
            const markElement = document.createElement('div');
            markElement.classList.add('legend-mark');
            markElement.textContent = mark;
            if (index === 0) {
                markElement.style.textAlign = 'left';
            } else if (index === marks.length - 1) {
                markElement.style.textAlign = 'right';
            }
            marksContainer.appendChild(markElement);
        });

        // wrap all legend items in one div
        const legendItemsDiv = document.createElement('div');
        legendItemsDiv.classList.add('legend-items');
        const newLegendItems = legend.querySelectorAll('.legend-item');
        newLegendItems.forEach(item => legendItemsDiv.appendChild(item));

        // Append the title, gradient, marks, and legend items container to the legend element
        legend.innerHTML = ''; // Clear existing content
        legend.appendChild(gradientMarksContainer);
        legend.appendChild(legendItemsDiv);
    }
}


function updateLegend2_2() {
    const title = 'Percent increase from list price';
    const marks = ['0%', '4%', '8%']; // New marks for Legend 2

    const legend = document.querySelector('#legend2');

    // Update legend title
    const legendTitle = legend.querySelector('.legend-title2');
    legendTitle.textContent = title;

    // Update the marks
    const markElements = legend.querySelectorAll('.legend-mark');
    marks.forEach((mark, index) => {
        markElements[index].textContent = mark;
    });
}

    // Function for tooltips
    function popup() {
    let popup = null; // declare the popup variable

    map2.on('mouseenter', 'rent-bidding-point-data-jitter', (event) => {
        const feature = event.features[0];
        let priceDifference = feature.properties.PRICE_DIFFERENCE;

        let textColor;
        let formattedPriceDifference;

        if (priceDifference > 0) {
            textColor = '#EDA229'; // Color for positive numbers
            formattedPriceDifference = `+$${priceDifference}`;
        } else if (priceDifference < 0) {
            textColor = '#65AFFF'; // Color for negative numbers
            formattedPriceDifference = `-$${Math.abs(priceDifference)}`;
        } else {
            textColor = '#fafafa'; // Color for zero
            formattedPriceDifference = `$${priceDifference}`;
        }

        const fullBaths = feature.properties.NO_FULL_BATHS;
        const halfBaths = feature.properties.NO_HALF_BATHS;

        const totalBaths = fullBaths + (halfBaths / 2);

        const formattedTotalBaths = totalBaths % 1 === 0 ? totalBaths.toFixed(0) : totalBaths.toFixed(1);


        let popupContent = `
            <p style='font-size: 18px; color: #fafafa; background-color: #444; padding: 0 2px 0 2px; margin-bottom: 1px'>Change from list price: <span style="color: ${textColor}; font-weight: bold;">${formattedPriceDifference}</span</p>
                <div style="display: flex; justify-content: space-between;">
                    <p style="font-size: 16px; flex: 1; margin-right: 10px; margin-bottom: 0">List price:</p>
                    <p style="font-size: 16px; margin: 0;">$${feature.properties.LIST_PRICE}</p>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <p style="font-size: 16px; flex: 1; margin-right: 10px; margin-bottom: 0">Bedrooms:</p>
                    <p style="font-size: 16px; margin: 0;">${feature.properties.NO_BEDROOMS}</p>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <p style="font-size: 16px; flex: 1; margin-right: 10px; margin-bottom: 0">Bathrooms:</p>
                    <p style="font-size: 16px; margin: 0;">${formattedTotalBaths}</p>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <p style="font-size: 16px; flex: 1; margin-right: 10px; margin-bottom: 0">Square feet:</p>
                    <p style="font-size: 16px; margin: 0;">${feature.properties.SQUARE_FEET}</p>
                </div>
        `;

        // Create and set the popup content
        popup = new mapboxgl.Popup({
            offset: [0, -15],
            closeButton: false
        })
        .setLngLat(feature.geometry.coordinates)
        .setHTML(popupContent)
        .addTo(map2);
    });

    map2.on('mouseleave', 'rent-bidding-point-data-jitter', () => {
        // Remove the popup when the user stops hovering over the marker.
        if (popup) {
        popup.remove();
        popup = null; // reset the popup variable
        }
    });
    };


    function animateZipInfo() {
        const zipInfo = document.getElementById('zipInfo');
        zipInfo.style.transform = 'translateX(-100%)';
        zipInfo.style.visibility = 'visible';
        zipInfo.style.transition = 'transform 0.5s ease';
        setTimeout(() => {
            zipInfo.style.transform = 'translateX(0)';
        }, 10);
    }

    function reverseAnimateZipInfo() {
        const zipInfo = document.getElementById('zipInfo');
        zipInfo.style.transform = 'translateX(0)';
        zipInfo.style.transition = 'transform 0.5s ease';
        zipInfo.style.transform = 'translateX(-100%)';
        setTimeout(() => {
            zipInfo.style.visibility = 'hidden'
        }, 250);

    }

                    // Update the content of the zipInfo elements
                // Assign all stats to variables for ease
                stat0 = document.getElementById('zipCode');
                stat1 = document.getElementById('stat1');
                stat2 = document.getElementById('stat2');
                stat3 = document.getElementById('stat3');
                stat4 = document.getElementById('stat4');
                stat5 = document.getElementById('stat5');
                stat6 = document.getElementById('stat6');
                stat7 = document.getElementById('stat7');
                stat8 = document.getElementById('stat8');
                stat9 = document.getElementById('stat9');
                stat10 = document.getElementById('stat10');
                stat11 = document.getElementById('stat11');
                stat12 = document.getElementById('stat12');
                stat13 = document.getElementById('stat13');
                stat14 = document.getElementById('stat14');
                stat15 = document.getElementById('stat15');
                stat16 = document.getElementById('stat16');
                stat17 = document.getElementById('stat17');
                stat18 = document.getElementById('stat18');
                stat19 = document.getElementById('stat19');
                city1 = document.getElementById('city1');
                city2 = document.getElementById('city2');
                city3 = document.getElementById('city3');
                studentPop = document.getElementById('studentPop');

                async function updateStats() {
                // You can now use the cached data in this function
                let filteredFeatures = cache.features.filter(feature => feature.properties['ZIP_CODE'] === selectedZipCode);
                        filteredFeatures.forEach(feature => {
                            value0 = feature.properties['ZIP_CODE'];
                            value1 = feature.properties['PERCENT_PRICE_DIFFERENCE'];
                            value2 = feature.properties['PERCENT_DIFFERENCE'];
                            value3 = feature.properties['MAX_PERCENT'];
                            value4 = feature.properties['MIN_PERCENT'];
                            value5 = feature.properties['RAW_DIFFERENCE'];
                            value6 = feature.properties['MAX_DIFFERENCE'].toLocaleString();
                            value7 = feature.properties['MIN_DIFFERENCE'];
                            value8 = feature.properties['DIFF_FROM_CITY_PERCENT_SHARE'];
                            value9 = feature.properties['DIFF_FROM_CITY_PERCENT'];
                            value10 = feature.properties['DIFF_FROM_CITY_RAW'];
                            value11 = (!isNaN(parseInt(feature.properties['POPULATION'].replace(/,/g, ''), 10)) ? (parseInt(feature.properties['POPULATION'].replace(/,/g, ''), 10) / 1000).toFixed(1) : 0);
                            value12 = feature.properties['STUDENTS_POP'];
                            value13 = feature.properties['PERCENT_POVERTY'];
                            value14 = ((feature.properties['MEDIAN_INCOME'] / 1000).toFixed(1));
                            value15 = feature.properties['BLACK'];
                            value16 = feature.properties['LATINO'];
                            value17 = feature.properties['WHITE'];
                            value18 = feature.properties['ASIAN'];
                            value19 = feature.properties['TWO_OR_MORE_RACES'];
                            value20 = feature.properties['CITY'];

                            stat0.innerHTML = `0${value0}`;
                            stat1.innerHTML = `${value1}%`;
                            stat2.innerHTML = `${value2}%`;
                            stat3.innerHTML = `Max: ${value3}%`;
                            stat4.innerHTML = `Min: ${value4}%`;
                            stat5.innerHTML = `$${value5}`;
                            stat6.innerHTML = `Max: $${value6}`;
                            stat7.innerHTML = `Min: $${value7}`;
                            stat11.innerHTML = `${value11}K`;
                            stat12.innerHTML = value12;
                            stat13.innerHTML = `${value13}%`;
                            stat14.innerHTML = `$${value14}K`;
                            stat15.innerHTML = value15;
                            stat16.innerHTML = value16;
                            stat17.innerHTML = value17;
                            stat18.innerHTML = value18;
                            stat19.innerHTML = value19;
                            if (value8 < 0) {
                                city1.innerHTML = `<span style="color: #7A7A7A">${value8}%</span> ${value20} average`;
                            } else {
                                city1.innerHTML = `<span style="color: #FBB225">+${value8}%</span> ${value20} average`;
                            }
                            if (value9 < 0) {
                                city2.innerHTML = `<span style="color: #7A7A7A">${value9}%</span> ${value20} average`;
                            } else {
                                city2.innerHTML = `<span style="color: #FBB225">+${value9}%</span> ${value20} average`;
                            }
                            if (value10 < 0) {
                                city3.innerHTML = `<span style="color: #7A7A7A">$${value10}</span> ${value20} average`;
                            } else {
                                city3.innerHTML = `<span style="color: #FBB225">+$${value10}</span> ${value20} average`;
                            }
                            if (value20 != 'Boston') {
                                studentPop.style.display = 'none';
                            } else {
                                studentPop.style.display = 'flex';
                            }
                        });
                    };

    function zoomToLocation(coordinates) {
        map2.flyTo({
            center: [coordinates[0] - 0.01, coordinates[1]],
            zoom: 13,
            speed: 1.5
        });
    }

    function geocodeZipCode(zipCode) {
        const apiUrl = `https://api.mapbox.com/geocoding/v5/mapbox.places/${zipCode}.json?access_token=${mapboxgl.accessToken}`;

        return fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                const coordinates = data.features[0].center;
                return coordinates;
            });
    }

    document.getElementById('zipInput').addEventListener('change', function() {
        var zipCode = this.value;

        geocodeZipCode(zipCode).then(function(coordinates) {
            zoomToLocation(coordinates);
        });
    });

    const zipList = document.getElementById('zipList');
    const zipInput = document.getElementById('zipInput');
    const zipCodes = [
        '02134', '02125', '02110', '02118', '02126', '02109', '02113', '02130', '02121', '02119',
        '02115', '02163', '02135', '02199', '02124', '02132', '02114', '02108', '02136', '02111',
        '02210', '02116', '02131', '02127', '02120', '02203', '02215', '02129', '02128', '02122',
        '02151', '02467', '02445', '02446', '02447', '02467', '02141', '02142', '02139', '02138',
        '02140', '02143', '02144', '02145'
    ];

    zipInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const matchingZipCodes = zipCodes.filter(zipCode => zipCode.includes(searchTerm));
        renderAutocompleteList(matchingZipCodes);
    });

    function renderAutocompleteList(zipCodes) {
    zipList.innerHTML = '';
    zipList.style.display = 'block';

    if (zipCodes.length > 0) {
        zipCodes.forEach(zipCode => {
            const listItem = document.createElement('li');
            listItem.textContent = zipCode;
            listItem.addEventListener('click', function() {
                geocodeZipCode(zipCode).then(function(coordinates) {
                    zoomToLocation(coordinates);
                });
                zipInput.value = zipCode;
                zipList.style.display = 'none';
                // Animate the zip info div
                animateZipInfo();
                
                selectedZipCode = parseInt(zipCode);

                // Set the opacity of the zip code outline layer to 1 for the selected zip code
                map2.setPaintProperty('zipOutline', 'line-opacity', [
                    'case',
                    ['==', ['get', 'POSTCODE'], selectedZipCode],
                    1,
                    0
                ]);

                updateStats();
            });
            zipList.appendChild(listItem);
        });
    } else {
        zipList.style.display = 'none';
    }

    // Add keyup event listener to zipInput
    document.getElementById('zipInput').addEventListener('keyup', function(event) {
        if (event.key === 'Enter') {
            animateZipInfo();
            const zipCode = zipInput.value;
            selectedZipCode = parseInt(zipCode);
            map2.setPaintProperty('zipOutline', 'line-opacity', [
                    'case',
                    ['==', ['get', 'POSTCODE'], selectedZipCode],
                    1,
                    0
                ]);
            updateStats();
        }
    });
}

    document.getElementById('zipInput').addEventListener('input', function() {
    if (getComputedStyle(zipInfo).visibility === 'visible') {
        reverseAnimateZipInfo();
        map2.setPaintProperty('zipOutline', 'line-opacity', 0);
    }
    });


    document.addEventListener('click', function(event) {
        if (!zipList.contains(event.target) && event.target !== zipInput) {
            zipList.style.display = 'none';
        }
    });

    document.querySelectorAll('.toggle-button').forEach(function(button) {
            button.addEventListener('click', function() {
                const selectedValue = this.getAttribute('data-value');

                // Remove 'active' class from all buttons
                document.querySelectorAll('.toggle-button').forEach(function(btn) {
                    btn.classList.remove('active');
                });

                // Add 'active' class to the clicked button
                this.classList.add('active');

                // Handle selected value
                if (selectedValue === 'layer1') {
                    map2.setPaintProperty('percent-positive-price-difference', 'fill-opacity', 0.8);
                    map2.setPaintProperty('percent-increase-by-zipcode', 'fill-opacity', 0);
                    updateLegend1_1();
                } else if (selectedValue === 'layer2') {
                    map2.setPaintProperty('percent-increase-by-zipcode', 'fill-opacity', 0.8);
                    map2.setPaintProperty('percent-positive-price-difference', 'fill-opacity', 0);
                    updateLegend2_2();
                }
            });
        });

document.getElementById('showMoreButton').addEventListener('click', function() {
    const additionalStats = document.getElementById('additionalStats');
    const buttonText = this.querySelector('.button-text');
    
    if (additionalStats.style.display === 'none') {
        additionalStats.style.display = 'block';
        buttonText.innerText = 'Show Less';
        buttonText.setAttribute('data-text', 'show-less');
        additionalStats.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' });
    } else {
        additionalStats.style.display = 'none';
        buttonText.innerText = 'View more data';
        buttonText.setAttribute('data-text', 'show-more');
    }
});




let cache = null;

map2.on('load', async function() {
    // This code will run once the style has fully loaded
    map2.setPaintProperty('percent-positive-price-difference', 'fill-opacity', 0.8);
    map2.setPaintProperty('rent-bidding-point-data-jitter', 'circle-opacity', 0.8);
    map2.setPaintProperty('rent-bidding-point-data-jitter', 'circle-stroke-opacity', 0.8);
    popup();
    updateLegend1_1();
    document.querySelector('.toggle-button[data-value="layer1"]').classList.add('active');

    // Fetch and cache data
    if (!cache) {
        cache = await fetch('https://api.mapbox.com/datasets/v1/elijah-messmer/clokh0dth1x5i2nrno97er5h8/features?access_token=pk.eyJ1IjoiZWxpamFoLW1lc3NtZXIiLCJhIjoiY2xmYWNkMnFnMDRiZTNwcGJsM2J0ZjRpeCJ9.srDYVTRF4yqQ9QIz5b3EvA')
            .then(response => response.json());
    }
    });
});
    </script>

</body>
</main>
</html>
